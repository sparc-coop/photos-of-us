"use strict";function PrintType(n){function t(n){this.id=n.id;this.type=n.type;this.height=n.height;this.length=n.length;this.icon=n.icon}this.id;this.type;this.height;this.length;this.icon;t.call(this,n)}function Photo(n,t){function u(n){this.printTypeId=n.printTypeId;this.getPhotoInfo=i.bind(this);i(n.photoId)}function i(n){t.get("/api/Photo/"+n).then(n=>{console.log(n.data),Object.keys(n.data).map(t=>{r[t]=n.data[t]})})}var r=this;u.call(this,n)}var app=angular.module("app",["ngMaterial","angularFileUpload","monospaced.elastic"]);app.factory("photoApi",["$http","$rootScope",function(n){var t="/api/Photo";return{getFolders:function(){return n.get(t+"/GetFolders")}}}]);app.factory("folderApi",["$http","$rootScope",function(n){var t="/api/Folder";return{add:function(i){return n.post(t+"/?name="+i)},"delete":function(i){return n.post(t+"/DeleteFolder/"+i)}}}]);app.factory("cardApi",["$http","$rootScope",function(n){var t="/api/Card";return{getAll:function(){return n.get(t)}}}]);app.controller("CheckoutCtrl",["$scope","$window","$location","$http",(n,t,i,r)=>{function u(){var n=!0;try{localStorage.setItem("__availability_test","test");localStorage.removeItem("__availability_test")}catch(t){n=!1}finally{return n}}n.goToCart=()=>{t.location.href="/Photo/Cart"};n.goToCheckout=()=>{t.location.href="/Photo/Checkout"};n.getPrintTypes=()=>{r.get("/api/Photo/GetPrintTypes").then(t=>{n.printTypes=t.data,console.log(n.printTypes)})};n.selectedItems=[];n.select=t=>{var i=location.pathname.split("/").filter(n=>!!n).pop(),o={photoId:i,printTypeId:t},r={},f,e;u()&&(f=localStorage.getItem("cart"),r=f?JSON.parse(f):{});console.log(i);r[i]=o;localStorage.setItem("cart",JSON.stringify(r));console.log(localStorage.getItem("cart"));n.selectedItems.length===0?n.selectedItems.push(t):n.selectedItems.indexOf(t)!==-1?(e=n.selectedItems.indexOf(t),n.selectedItems.splice(e,1)):n.selectedItems.push(t)};n.createOrder=()=>{t.location.href="/Photo/Cart"};n.getOrder=()=>{r.get("/api/Checkout/GetOrder").then(t=>{n.printTypes=t.data,console.log(n.printTypes)})}}]);app.controller("FolderCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","folderApi",(n,t,i,r,u,f)=>{n.close=()=>r.hide(),n.folders=[],n.initFolderCtrl=function(){u.getFolders().then(function(t){angular.forEach(t.data,function(t){n.folders.push(t)});console.log(JSON.stringify(t.data))})},n.newFolderModal=()=>{r.show({templateUrl:"/Photographer/NewFolderModal",controller:"FolderCtrl",clickOutsideToClose:!0})},n.addFolder=function(i){f.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)})}]);app.controller("ModalController",["$scope","$window","$mdDialog",(n,t,i)=>{n.close=()=>i.hide()}]);app.controller("PaymentCtrl",["$scope","$window","$http",(n,t,i)=>{function f(){var n=!0;try{localStorage.setItem("__availability_test","test");localStorage.removeItem("__availability_test")}catch(t){n=!1}finally{return n}}var r,u;n.cartItems=[];r={};f()?(u=localStorage.getItem("cart"),r=u?JSON.parse(u):{},console.log(r),Object.values(r).map(t=>n.cartItems.push(new Photo(t,i))),console.log(n.cartItems)):console.log("local storage unavailable");n.printTypes={};n.getPrintTypes=()=>{i.get("/api/Photo/GetPrintTypes").then(t=>{n.printTypes=t.data,console.log(n.printTypes)})};n.getPrintTypes();n.getAssociatedPrintType=t=>{var i=n.printTypes[t];return i?new PrintType(n.printTypes[t]):t};n.sumCart=()=>{var t=n.cartItems.reduce((n,t)=>(n.price||0)+(t.price||0),0);return console.log("sum",t),t};n.address={};n.saveAddress=t=>{var r={FullName:t.FirstName+" "+t.LastName};i.post("/api/Photo/GetPrintTypes",r).then(t=>{n.printTypes=t.data,console.log(n.printTypes)})};n.initStripe=()=>{var i=Stripe("pk_test_P8L41KOstSk7oCzeV7mDoRY3"),f=i.elements(),t=f.create("card",{style:{base:{fontSize:"16px",lineHeight:"24px"}}}),r,u;t.mount("#card-element");t.addEventListener("change",{error:n}=>{var t=document.getElementById("card-errors");t.textContent=n?n.message:""});r=t=>{var r=document.getElementById("payment-form"),i=document.createElement("input"),u;i.setAttribute("type","hidden");i.setAttribute("name","stripeToken");i.setAttribute("value",t.id);r.appendChild(i);u={stripeToken:t.id,amount:n.sumCart()};r.submit()};u=document.getElementById("payment-form");u.addEventListener("submit",n=>{n.preventDefault(),i.createToken(t).then(n=>{if(n.error){var t=document.getElementById("card-errors");t.textContent=n.error.message}else r(n.token)})})}}]);app.controller("PhotoCtrl",["$scope","$window","$location","$http","$mdDialog",(n,t,i,r,u)=>{n.viewPhoto=n=>{t.location.href="/Photographer/Photo/"+n},n.goToPurchase=n=>{t.location.href="/Photo/Purchase/"+n},n.goToGallery=n=>{t.location.href="/Photographer/Photos/"+n},n.openUpload=()=>{u.show({templateUrl:"/Photographer/Upload",controller:"ModalController",clickOutsideToClose:!0})},n.getPhotoCode=()=>{n.code=i.absUrl().split("=")[1]},n.getPhotographer=t=>{r.get("/api/Photo/GetPhotographer/"+t).then(t=>{n.photographer=t.data})}}]);app.controller("UploadController",["$scope","$http","FileUploader","$window","$mdDialog",function(n,t,i,r){n.currentCode="";var u=n.uploader=new i({url:"/Photographer/UploadPhotoAsync"});n.$watch(function(){return u.queue.length},function(t,i){t<i&&u.queue.length===0&&(n.dropZone={Height:300})});u.codeGenerator=function(n){n.upload()};n.photoNameValidation=function(n){for(var i=["drop table","alter table","create database","create table","create view","delete from","drop database","drop index","insert into","truncate table","script>"],t=0;t<i.length;t++)(n.target.value.indexOf(i[t])>-1||n.target.value.indexOf("select")>-1&&n.target.value.indexOf("from")>-1||n.target.value.indexOf("update")>-1&&n.target.value.indexOf("set")>-1)&&(n.target.value="Code detected",document.getElementById("photo-preview-name").focus(),document.getElementById("photo-preview-name").blur())};n.photoCodeValidation=function(n){var i=new RegExp("^[A-Za-z0-9_-]+$");i.test(n.key)?t.get("VerifyIfCodeAlreadyUsed").then(function(t){t.data.photoExisting===!0?(angular.element(n.target).addClass("error"),angular.element(n.target).prop("title","Photo code already used, choose another")):(angular.element(n.target).removeClass("error"),angular.element(n.target).prop("title",""))}):n.preventDefault()};u.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|tif".indexOf(t)!==-1}});n.upload=function(t){var i=n.VerifyErrorsInPhotoCode();i===!1?t.upload():alert("Fix the photos with exclamation first before uploading")};n.uploadAll=function(t){console.log("clicked upload");var i=n.VerifyErrorsInPhotoCode();i===!1?angular.forEach(t,function(n){n.upload()}):alert("Fix the photos with exclamation first before uploading")};n.VerifyErrorsInPhotoCode=function(){var n=!1,t=angular.element(document.querySelector(".code"));return angular.forEach(t,function(t){t.classList.contains("error")&&(n=!0)}),n};n.selectItem=function(t,i){n.selectedItem=i};n.removeItem=function(t){this.uploader.removeFromQueue(t);this.uploader.queue.length>0&&(n.selectedItem=this.uploader.queue[0])};u.onWhenAddingFileFailed=function(){};u.onAfterAddingFile=function(t){var r,i;console.log("on after adding file");n.dropZone={Height:100};u.codeGenerator(t);r=t.file.name;t.file.fileExtension=r.split(".").pop();i=new Image;i.src=window.URL.createObjectURL(t._file);i.onload=function(){t.file.dimensions=i.naturalWidth+"x"+i.naturalHeight;t.file.src=i.src;n.$apply()};n.selectedItem=t};u.onAfterAddingAll=function(){};u.onBeforeUploadItem=function(n){var t="";n.file.photoCode&&(t=n.file.photoCode);n.formData.push({photoName:n.file.name,photoCode:t,extension:"."+n.file.fileExtension})};u.onProgressItem=function(){};u.onProgressAll=function(){};u.onSuccessItem=function(n){console.log("uploader.onSuccessItem "+JSON.stringify(n))};u.onErrorItem=function(){};u.onCancelItem=function(){};u.onCompleteItem=function(){};u.onCompleteAll=()=>{r.location.reload()}}]);app.controller("CardCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","cardApi",(n,t,i,r,u,f)=>{n.close=()=>r.hide(),n.cards=[],n.initCardCtrl=function(){f.getAll().then(function(t){angular.forEach(t.data,function(t){n.cards.push(t)});console.log(JSON.stringify(t.data))})},n.exportMultipleCardsModal=function(){r.show({templateUrl:"/Photographer/MultipleCardsModal",controller:"CardCtrl",clickOutsideToClose:!0})},n.exportMultipleCards=function(n){location.href="/Photographer/ExportMultipleCards/?quantity="+n},n.addFolder=function(i){folderApi.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)})}]);