"use strict";var app=angular.module("app",["ngMaterial","angularFileUpload","monospaced.elastic"]);app.factory("photoApi",["$http","$rootScope",function(n){var t="/api/Photo";return{getFolders:function(){return n.get(t+"/GetFolders")}}}]);app.factory("folderApi",["$http","$rootScope",function(n){var t="/api/Folder";return{add:function(i){return n.post(t+"/?name="+i)},"delete":function(i){return n.post(t+"/DeleteFolder/"+i)}}}]);app.factory("cardApi",["$http","$rootScope",function(n){var t="/api/Card";return{getAll:function(){return n.get(t)},create:function(i){return n.post(t+"/Create/"+i)}}}]);app.factory("photographerApi",["$http","$rootScope",function(n){var t="/api/Photographer";return{getAccountSettings:function(){return n.get(t+"/GetAccountSettings")},saveAccountSettings:function(i){return console.log(JSON.stringify(i)),n.post(t+"/PostAccountSettings",i)}}}]);app.factory("checkoutApi",["$http","$rootScope",function(){return{}}]);app.controller("CheckoutCtrl",["$scope","$window","$location","$http",(n,t,i,r)=>{n.goToCart=()=>{t.location.href="/Photo/Cart"},n.goToCheckout=()=>{t.location.href="/Photo/Checkout"},n.getPrintTypes=()=>{r.get("/api/Photo/GetPrintTypes").then(t=>{n.printTypes=t.data,console.log(n.printTypes)})},n.selectedItems=[],n.select=t=>{if(n.selectedItems.length===0)n.selectedItems.push(t);else if(n.selectedItems.indexOf(t)!==-1){var i=n.selectedItems.indexOf(t);n.selectedItems.splice(i,1)}else n.selectedItems.push(t)},n.addToCart=function(t){n.select(t);n.createOrder()},n.createOrder=()=>{t.location.href="/Photo/Cart"},n.getOrder=()=>{r.get("/api/Checkout/GetOrder").then(t=>{n.printTypes=t.data,console.log(n.printTypes)})}}]);app.controller("FolderCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","folderApi",(n,t,i,r,u,f)=>{n.close=()=>r.hide(),n.folders=[],n.initFolderCtrl=function(){u.getFolders().then(function(t){angular.forEach(t.data,function(t){n.folders.push(t)});console.log(JSON.stringify(t.data))})},n.newFolderModal=()=>{r.show({templateUrl:"/Photographer/NewFolderModal",controller:"FolderCtrl",clickOutsideToClose:!0})},n.addFolder=function(i){f.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)})}]);app.controller("ModalController",["$scope","$window","$mdDialog",(n,t,i)=>{n.close=()=>i.hide()}]);app.controller("PaymentCtrl",["$scope","$window",n=>{n.saveAddress=t=>{var i={FullName:t.FirstName+" "+t.LastName};$http.post("/api/Photo/GetPrintTypes",i).then(t=>{n.printTypes=t.data,console.log(n.printTypes)})},n.initStripe=()=>{var t=Stripe("pk_test_P8L41KOstSk7oCzeV7mDoRY3"),u=t.elements(),n=u.create("card",{style:{base:{fontSize:"16px",lineHeight:"24px"}}}),i,r;n.mount("#card-element");n.addEventListener("change",{error:n}=>{var t=document.getElementById("card-errors");t.textContent=n?n.message:""});i=n=>{var i=document.getElementById("payment-form"),t=document.createElement("input");t.setAttribute("type","hidden");t.setAttribute("name","stripeToken");t.setAttribute("value",n.id);i.appendChild(t);i.submit()};r=document.getElementById("payment-form");r.addEventListener("submit",r=>{r.preventDefault(),t.createToken(n).then(n=>{if(n.error){var t=document.getElementById("card-errors");t.textContent=n.error.message}else i(n.token)})})}}]);app.controller("PhotoCtrl",["$scope","$window","$location","$http","$mdDialog",(n,t,i,r,u)=>{n.viewPhoto=n=>{t.location.href="/Photographer/Photo/"+n},n.goToPurchase=n=>{t.location.href="/Photo/Purchase/"+n},n.goToGallery=n=>{t.location.href="/Photographer/Photos/"+n},n.openUpload=n=>{u.show({templateUrl:"/Photographer/Upload",controller:"UploadController",locals:{folder:n},clickOutsideToClose:!0})},n.getPhotoCode=()=>{n.code=i.absUrl().split("=")[1]},n.openEdit=()=>{u.show({templateUrl:"/Photographer/BulkEditModal",controller:"BulkEditController",clickOutsideToClose:!0})},n.getPhotographer=t=>{r.get("/api/Photo/GetPhotographer/"+t).then(t=>{n.photographer=t.data})}}]);angular.module("app").controller("UploadController",function(n,t,i,r,u,f,e){n.folderId=e;n.close=()=>u.hide();var o=n.uploader=new i({url:"/Photographer/UploadPhotoAsync"});n.$watch(function(){return o.queue.length},function(t,i){t<i&&o.queue.length===0&&(n.dropZone={Height:300})});o.codeGenerator=function(n){n.upload()};n.photoNameValidation=function(n){for(var i=["drop table","alter table","create database","create table","create view","delete from","drop database","drop index","insert into","truncate table","script>"],t=0;t<i.length;t++)(n.target.value.indexOf(i[t])>-1||n.target.value.indexOf("select")>-1&&n.target.value.indexOf("from")>-1||n.target.value.indexOf("update")>-1&&n.target.value.indexOf("set")>-1)&&(n.target.value="Code detected",document.getElementById("photo-preview-name").focus(),document.getElementById("photo-preview-name").blur())};n.photoCodeValidation=function(n){var i=new RegExp("^[A-Za-z0-9_-]+$");i.test(n.key)?t.get("VerifyIfCodeAlreadyUsed").then(function(t){t.data.photoExisting===!0?(angular.element(n.target).addClass("error"),angular.element(n.target).prop("title","Photo code already used, choose another")):(angular.element(n.target).removeClass("error"),angular.element(n.target).prop("title",""))}):n.preventDefault()};o.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|tif".indexOf(t)!==-1}});n.upload=function(t){var i=n.VerifyErrorsInPhotoCode();i===!1?t.upload():alert("Fix the photos with exclamation first before uploading")};n.uploadAll=function(t){var u,i;console.log("clicked upload");u=n.VerifyErrorsInPhotoCode();u===!1?(i=[],angular.forEach(t,function(n){i.push(n.upload())}),$q.all(i).then(()=>{r.location.reload()})):alert("Fix the photos with exclamation first before uploading")};n.VerifyErrorsInPhotoCode=function(){var n=!1,t=angular.element(document.querySelector(".code"));return angular.forEach(t,function(t){t.classList.contains("error")&&(n=!0)}),n};n.selectItem=function(t,i){n.selectedItem=i};n.removeItem=function(t){this.uploader.removeFromQueue(t);this.uploader.queue.length>0&&(n.selectedItem=this.uploader.queue[0])};o.onWhenAddingFileFailed=function(){};o.onAfterAddingFile=function(t){var r,i;console.log("on after adding file");n.dropZone={Height:100};r=t.file.name;t.file.fileExtension=r.split(".").pop();o.codeGenerator(t);i=new Image;i.src=window.URL.createObjectURL(t._file);i.onload=function(){t.file.dimensions=i.naturalWidth+"x"+i.naturalHeight;t.file.src=i.src;n.$apply()};n.selectedItem=t};o.onAfterAddingAll=function(){};o.onBeforeUploadItem=function(t){var i="";console.log(t.code);t.code&&(i=t.code);t.formData.length>0?t.formData[0].photoCode=i:t.formData.push({photoName:t.file.name,photoCode:i,extension:"."+t.file.fileExtension,folderId:n.folderId})};o.onProgressItem=function(){};o.onProgressAll=function(){};o.onSuccessItem=function(n,t){var u,r,i;if(console.log("uploader.onSuccessItem "+t),console.log(n),console.log(o.queue),t!="")for(n.formData[0].photoCode=t,n.code=t,n.isCode=!0,u=f("filter")(o.queue,{code:t},!0)[0],r=o.queue.indexOf(u),console.log(r),i=r-1;i>=0;i--)if(o.queue[i].isCode)break;else o.queue[i].code=t};o.onErrorItem=function(){};o.onCancelItem=function(){};o.onCompleteItem=function(){};o.onCompleteAll=()=>{}});app.controller("CardCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","cardApi","$timeout",(n,t,i,r,u,f,e)=>{n.close=()=>r.hide(),n.cards=[],n.cardsToExport=[],n.initCardCtrl=function(){n.cards=[];f.getAll().then(function(t){n.cards=t.data})},n.exportMultipleCardsModal=function(){r.show({templateUrl:"/Photographer/MultipleCardsModal",scope:n,clickOutsideToClose:!0})},n.exportMultipleCards=function(t){f.create(t).then(function(t){console.log(t.data);console.log(n.cards);n.cards=t.data.concat(n.cards);console.log(n.cards);r.hide();n.downloadCards(t.data)})},n.downloadCards=function(t){n.cardsToExport=t;e(function(){$("#card-downloader").submit()})},n.addFolder=function(i){folderApi.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)})}]);app.controller("PhotographerCtrl",["$scope","$window","$location","$http","$mdDialog","photographerApi",(n,t,i,r,u,f)=>{n.viewPhoto=n=>{t.location.href="/Photographer/Photo/"+n},n.openUpload=()=>{u.show({templateUrl:"/Photographer/UploadProfilePhoto",controller:"ModalController",clickOutsideToClose:!0})},n.getProfile=function(){f.getAccountSettings().then(function(t){n.photographer=t.data})}}]);app.controller("UploadPhotographerProfileCtrl",["$scope","$http","FileUploader","$window","$mdDialog",function(n,t,i,r){var u=n.uploader=new i({url:"/Photographer/UploadProfilePhotoAsync"});n.$watch(function(){return u.queue.length},function(t,i){t<i&&u.queue.length===0&&(n.dropZone={Height:300})});n.photoNameValidation=function(n){for(var i=["drop table","alter table","create database","create table","create view","delete from","drop database","drop index","insert into","truncate table","script>"],t=0;t<i.length;t++)(n.target.value.indexOf(i[t])>-1||n.target.value.indexOf("select")>-1&&n.target.value.indexOf("from")>-1||n.target.value.indexOf("update")>-1&&n.target.value.indexOf("set")>-1)&&(n.target.value="Code detected",document.getElementById("photo-preview-name").focus(),document.getElementById("photo-preview-name").blur())};u.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|tif".indexOf(t)!==-1}});n.upload=function(n){n.upload()};n.uploadAll=function(n){console.log("clicked upload");angular.forEach(n,function(n){n.upload()})};n.selectItem=function(t,i){n.selectedItem=i};n.removeItem=function(t){this.uploader.removeFromQueue(t);this.uploader.queue.length>0&&(n.selectedItem=this.uploader.queue[0])};u.onWhenAddingFileFailed=function(){};u.onAfterAddingFile=function(t){var r,i;console.log("on after adding file");n.dropZone={Height:100};r=t.file.name;t.file.fileExtension=r.split(".").pop();i=new Image;i.src=window.URL.createObjectURL(t._file);i.onload=function(){t.file.dimensions=i.naturalWidth+"x"+i.naturalHeight;t.file.src=i.src;n.$apply()};n.selectedItem=t};u.onAfterAddingAll=function(){};u.onBeforeUploadItem=function(n){n.formData.push({photoName:n.file.name,extension:"."+n.file.fileExtension})};u.onProgressItem=function(){};u.onProgressAll=function(){};u.onErrorItem=function(){};u.onCancelItem=function(){};u.onCompleteItem=function(){};u.onCompleteAll=()=>{r.location.reload()}}]);app.controller("PhotographerAccountCtrl",["$scope","$window","$location","$http","$mdDialog","photographerApi",(n,t,i,r,u,f)=>{n.originalSettings={},n.initAccountSettings=function(){f.getAccountSettings().then(function(t){console.log(JSON.stringify(t));n.accountSettings=t.data;angular.copy(t.data,n.originalSettings);console.log(JSON.stringify(n.originalSettings))})},n.discardChanges=function(){console.log(JSON.stringify(n.originalSettings));n.accountSettings=angular.copy(n.originalSettings)},n.saveAccountSettings=function(t){console.log(JSON.stringify(t));n.showLoader=!0;f.saveAccountSettings(t).then(function(t){console.log(JSON.stringify(t));n.showLoader=!1;swal({position:"top-end",type:"success",title:"Your work has been saved",showConfirmButton:!1,timer:1500})},function(t){console.log(JSON.stringify(t));n.showLoader=!1;swal({position:"top-end",type:"error",title:"Oops... Something went wrong!",showConfirmButton:!1,timer:1500})})},n.uploadProfileImage=()=>{u.show({templateUrl:"/Photographer/UploadProfileImage",controller:"UploadProfileImageCtrl",clickOutsideToClose:!0})}}]);app.controller("CardCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","cardApi","$timeout",(n,t,i,r,u,f,e)=>{n.close=()=>r.hide(),n.cards=[],n.cardsToExport=[],n.initCardCtrl=function(){n.cards=[];f.getAll().then(function(t){n.cards=t.data})},n.exportMultipleCardsModal=function(){r.show({templateUrl:"/Photographer/MultipleCardsModal",scope:n,clickOutsideToClose:!0})},n.exportMultipleCards=function(t){f.create(t).then(function(t){console.log(t.data);console.log(n.cards);n.cards=t.data.concat(n.cards);console.log(n.cards);r.hide();n.downloadCards(t.data)})},n.downloadCards=function(t){n.cardsToExport=t;e(function(){$("#card-downloader").submit()})},n.addFolder=function(i){folderApi.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)})}]);app.controller("SalesHistoryCtrl",["$scope","$window","$location","$http",(n,t,i,r)=>{n.query="",n.querySalesHistory=n=>{$(".sales-container .overlay").addClass("loading"),r.get("/api/Photographer/SalesHistory?query="+n).then(n=>{n.status===200&&($(".sales-content").html(n.data),$(".sales-container .overlay").removeClass("loading"))})}}]);app.controller("UploadProfileImageCtrl",["$scope","$http","FileUploader","$window","$mdDialog",function(n,t,i,r,u){n.close=()=>u.hide();var f=n.uploader=new i({url:"/Photographer/UploadProfileImageAsync"});n.$watch(function(){return f.queue.length},function(t,i){t<i&&f.queue.length===0&&(n.dropZone={Height:300})});n.photoNameValidation=function(n){for(var i=["drop table","alter table","create database","create table","create view","delete from","drop database","drop index","insert into","truncate table","script>"],t=0;t<i.length;t++)(n.target.value.indexOf(i[t])>-1||n.target.value.indexOf("select")>-1&&n.target.value.indexOf("from")>-1||n.target.value.indexOf("update")>-1&&n.target.value.indexOf("set")>-1)&&(n.target.value="Code detected",document.getElementById("photo-preview-name").focus(),document.getElementById("photo-preview-name").blur())};f.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|tif".indexOf(t)!==-1}});n.upload=function(n){n.upload()};n.uploadAll=function(n){console.log("clicked upload");angular.forEach(n,function(n){n.upload()})};n.selectItem=function(t,i){n.selectedItem=i};n.removeItem=function(t){this.uploader.removeFromQueue(t);this.uploader.queue.length>0&&(n.selectedItem=this.uploader.queue[0])};f.onWhenAddingFileFailed=function(){};f.onAfterAddingFile=function(t){var r,i;console.log("on after adding file");n.dropZone={Height:100};r=t.file.name;t.file.fileExtension=r.split(".").pop();i=new Image;i.src=window.URL.createObjectURL(t._file);i.onload=function(){t.file.dimensions=i.naturalWidth+"x"+i.naturalHeight;t.file.src=i.src;n.$apply()};n.selectedItem=t};f.onAfterAddingAll=function(){};f.onBeforeUploadItem=function(n){n.formData.push({photoName:n.file.name,extension:"."+n.file.fileExtension})};f.onProgressItem=function(){};f.onProgressAll=function(){};f.onErrorItem=function(){};f.onCancelItem=function(){};f.onCompleteItem=function(){};f.onCompleteAll=()=>{r.location.reload()}}]);angular.module("app").controller("BulkEditController",function(){var n=this;n.readonly=!1;n.fruitNames=["Apple","Banana","Orange"];n.roFruitNames=angular.copy(n.fruitNames);n.editableFruitNames=angular.copy(n.fruitNames);n.tags=[];n.vegObjs=[{name:"Broccoli",type:"Brassica"},{name:"Cabbage",type:"Brassica"},{name:"Carrot",type:"Umbelliferous"}];n.newVeg=function(n){return{name:n,type:"unknown"}}});