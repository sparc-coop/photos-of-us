"use strict";function TagCtrl(){var n=this;n.tags=[{tag_title:"Travel"}];n.newTag=function(n){return{tag_title:n}}}var app=angular.module("app",["ngMaterial","angularFileUpload","monospaced.elastic","720kb.socialshare","ui.bootstrap","ngTagsInput","angular.filter"]);app.filter("startFrom",function(){return function(n,t){return n.slice(t)}});app.factory("photoApi",["$http","$rootScope",function(n){var t="/api/Photo";return{getFolders:function(){return n.get(t+"/GetFolders")}}}]);app.factory("folderApi",["$http","$rootScope",function(n){var t="/api/Folder";return{add:function(i){return n.post(t+"/?name="+i)},rename:function(i,r){return n.post(t+"/RenameFolder",JSON.stringify({Id:i,NewName:r}))},"delete":function(i){return n.post(t+"/DeleteFolder/"+i)}}}]);app.factory("cardApi",["$http","$rootScope",function(n){var t="/api/Card";return{getAll:function(){return n.get(t)},create:function(i){return n.post(t+"/Create/"+i)}}}]);app.factory("photographerApi",["$http","$rootScope",function(n){var t="/api/Photographer";return{getAccountSettings:function(){return n.get(t+"/GetAccountSettings")},saveAccountSettings:function(i){return console.log(JSON.stringify(i)),n.post(t+"/PostAccountSettings",i)}}}]);app.factory("checkoutApi",["$http","$rootScope",function(n){var t="/api/Checkout";return{createOrder:function(i,r){return n.get(t+"/CreateOrder/"+i,r)}}}]);app.factory("userApi",["$http","$rootScope",function(n){var t="/api/User";return{getUser:function(){return n.get(t+"/GetUser")}}}]);app.controller("BulkEditModalCtrl",["$scope","$window","$mdDialog","$http","selectedPhotos",(n,t,i,r,u)=>{n.close=()=>i.hide(),n.selectedPhotos=u,n.photosviewmodel={photos:[],tags:[]},n.deletePhotos=function(n){r.post("/api/Photographer/deletePhotos/",n);t.location.href="/Photographer/Profile/"},n.getTagsByPhotos=function(){console.log(n.selectedPhotos);r.post("/api/Photographer/GetTagsByPhotos/",n.selectedPhotos).then(function(t){n.tags=t.data;console.log(n.tags)})},n.getPhotoPrice=()=>{n.selectedPhotos.length<2&&r.get("/api/Photographer/GetPhotoPrice/"+n.selectedPhotos).then(function(t){n.price=t.data})},n.editPhotos=function(i,u,f){i.forEach(function(t){n.photosviewmodel.photos.push(t)});u.forEach(function(t){n.photosviewmodel.tags.push(t)});f!=null&&n.selectedPhotos.length<2&&r.post("/api/Photographer/SavePhotoPrice/"+i+"/"+f+"/");r.post("/api/Photographer/AddTags/",u).then(function(){r.post("/api/Photographer/EditPhotos/",n.photosviewmodel).then(function(i){n.tags=i.data;console.log(n.tags);t.location.reload()})})}}]);app.controller("CheckoutCtrl",["$scope","$window","$location","$http","userApi",(n,t,i,r,u)=>{function f(){var n=!0;try{localStorage.setItem("__availability_test","test");localStorage.removeItem("__availability_test")}catch(t){n=!1}finally{return n}}n.goToCart=n=>{t.location.href="/Photo/Cart/"+n};n.goToCheckout=n=>{t.location.href="/Photo/Checkout/"+n};n.getPrintTypes=()=>{r.get("/api/Photo/GetPrintTypes").then(t=>{n.printTypes=t.data})};n.selectedItems=[];n.select=(t,i)=>{var e=location.pathname.split("/").filter(n=>!!n).pop(),s={photoId:e,printTypeId:t},r={},u,o;f()&&(u=localStorage.getItem("cart"),r=u?JSON.parse(u):{});r[e]=s;localStorage.setItem("cart",JSON.stringify(r));n.selectedItems.length===0?(i==undefined&&(i=1),n.selectedItems.push({printTypeId:t,quantity:i})):n.selectedItems.find(n=>n.printTypeId==t)?(o=n.selectedItems.find(n=>n.printTypeId==t),n.selectedItems.splice(o,1)):(i==undefined&&(i=1),n.selectedItems.push({printTypeId:t,quantity:i}));console.log(n.selectedItems)};n.selectAll=function(t){for(var i=0;i<t.length;i++)n.select(t[i].Id)};n.isSelected=function(t){return n.selectedItems.find(n=>n.printTypeId==t)?!0:!1};n.showCart=!1;n.cartPreview=()=>{n.showCart==!1?(n.showCart=!0,n.getOpenOrder(n.user.Id),n.getPrintTypes()):n.showCart==!0&&(n.showCart=!1)};n.createOrder=t=>{console.log(n.selectedItems);var u=i.absUrl().split("Purchase/")[1];r.post("/api/Checkout/CreateOrder/"+t+"/"+u,n.selectedItems)};n.orderDetailsList=[];n.orderTotalList=[];n.totalSales=0;n.totalEarned=0;n.getOrderDetails=t=>{r.get("/api/Photo/GetOrderItems/"+t).then(t=>{n.orderDetails=t.data,angular.forEach(n.orderDetails,function(t){n.orderDetailsList.push(t);n.totalEarned+=t.Photo.Price})}),n.getOrderTotal(t)};n.getOrderTotal=t=>{r.get("/api/Checkout/GetOrderTotal/"+t).then(i=>{n.orderTotal=i.data,n.orderTotalList.push({id:t,total:n.orderTotal}),n.totalSales+=i.data})};n.getUser=()=>{u.getUser().then(function(t){n.user=t.data})};n.getOpenOrder=t=>{r.get("/api/Checkout/GetOpenOrder/"+t).then(t=>{n.order=t.data,t.data!=""&&n.getOrderTotal(n.order.Id)})};n.getUserAndAddress=()=>{u.getUser().then(function(t){n.user=t.data;r.get("/api/Checkout/GetAddress/"+n.user.Id).then(t=>{n.address=t.data,n.getOpenOrder(n.user.Id)})})};n.initConfirmation=()=>{n.getUserAndAddress()};n.createPwintyOrder=()=>{r({method:"POST",url:"https://sandbox.pwinty.com/v2.6/Orders",headers:{"X-Pwinty-MerchantId":"","X-Pwinty-REST-API-Key":"","Content-Type":"application/json",Accept:"application/json",crossDomain:!0},data:{merchantOrderId:"845",recipientName:"Pwinty Tester",Address1:"123 Test Street",Address2:"TESTING",addressTownOrCity:"TESTING",stateOrCounty:"TESTSHIRE",postalOrZipCode:"TE5 7IN",email:"test@testing.com",countryCode:"gb",preferredShippingMethod:"CHEAPEST",mobileTelephone:"01811 8055"}}).then(t=>{n.orderId=t.data,console.log("return Pwinty"),console.log(t),console.log(t.data)})};n.createMooOrder=()=>{r.post({method:"moo.pack.createPack",url:"http://www.moo.com/api/service/",headers:{"Content-Type":"application/json",Accept:"application/json"},data:{product:"businesscard",pack:{numCards:50,productCode:"businesscard",productVersion:1,sides:[]}}}).then(t=>{n.orderId=t.data,console.log("return Moo"),console.log(t),console.log(t.data)})};n.printQuality="Standard";n.getPwintyCatalog=()=>{r({method:"GET",url:"https://sandbox.pwinty.com/v2.6/Catalogue/US/Pro"}).then(t=>{console.log("Pwinty Catalog"),console.log(t.data),n.proProducts=t.data}),r({method:"GET",url:"https://sandbox.pwinty.com/v2.6/Catalogue/US/Standard"}).then(t=>{console.log("Pwinty Catalog"),console.log(t.data),n.standardProducts=t.data})};n.addPhotoToPwintyOrder=()=>{r({method:"POST",url:"https://sandbox.pwinty.com/v2.6/Orders/",headers:{"Content-Type":"application/json",Accept:"application/json",crossDomain:!0,"X-Pwinty-MerchantId":"","X-Pwinty-REST-API-Key":""},data:data}).then(t=>{n.orderId=t.data,console.log("return Pwinty"),console.log(t),console.log(t.data)})}}]);app.controller("DownloadCtrl",["$scope","$window","$mdDialog","$http","userApi",(n,t,i,r)=>{n.getOrders=t=>{r.get("/api/Photo/GetOrderPhotos/"+t).then(t=>{n.orders=t.data,console.log(t.data),angular.forEach(n.orders,function(t){n.getOrderItems(t.Id)})})},n.orderItems=[],n.getOrderItems=t=>{r.get("/api/Photo/GetOrderItems/"+t).then(t=>{n.orderItems.push(t.data)})},n.bulkDownload=n=>{r.post("/api/Photo/GetForDownload/"+n)}}]);app.controller("FolderCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","folderApi",(n,t,i,r,u,f)=>{n.close=()=>r.hide(),n.folders=[],n.initFolderCtrl=function(){n.orderByOption="Name";u.getFolders().then(function(t){angular.forEach(t.data,function(t){n.folders.push(t)})})},n.initRenameFolderModal=function(){n.folderId=folderId;n.folderName=folderName},n.newFolderModal=()=>{r.show({templateUrl:"/Photographer/NewFolderModal",controller:"FolderCtrl",clickOutsideToClose:!0})},n.renameFolderModal=n=>{r.show({templateUrl:"/Photographer/NewFolderModal",controller:"FolderRenameModalCtrl",locals:{folderId:n.Id,folderName:n.Name},clickOutsideToClose:!0})},n.addFolder=function(i){f.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.deleteFolder=function(n){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(i=>{i.value&&f.delete(n).then(()=>{t.$broadcast("FolderRemoved",n),swal("Deleted!","Your folder has been deleted.","success")})})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)}),n.$on("FolderRenamed",function(t,i){console.log("renamed folder - "+JSON.stringify(i));var r=n.folders.findIndex(n=>n.Id==i.Id);n.folders[r]=i}),n.$on("FolderRemoved",function(t,i){console.log("removed folder - "+JSON.stringify(i));var r=n.folders.findIndex(n=>n.Id==i);n.folders.splice(r,1)})}]);app.controller("FolderRenameModalCtrl",function(n,t,i,r,u,f,e,o){n.close=()=>r.hide();n.folderId=e;n.folderName=o;n.renameFolder=function(i,r){f.rename(i,r).then(function(i){n.close();t.$broadcast("FolderRenamed",i.data)})}});app.controller("ModalController",["$scope","$window","$mdDialog",(n,t,i)=>{n.close=()=>i.hide()}]);app.controller("PaymentCtrl",["$scope","$window","$http",(n,t,i)=>{n.orderTotal=0,n.getOrderDetails=t=>{i.get("/api/Photo/GetOrderItems/"+t).then(t=>{n.orderDetails=t.data,console.log(n.orderDetails)}),angular.forEach(n.orderDetails,function(t){n.orderTotal+t.UnitPrice})},n.getOrderTotal=t=>{i.get("/api/Checkout/GetOrderTotal/"+t).then(t=>{n.orderTotal=t.data})},n.initStripe=()=>{var t=Stripe("pk_test_Ck01BxsB9SEbgfDDjGFt8Nhd"),u=t.elements(),n=u.create("card",{style:{base:{fontSize:"16px",lineHeight:"24px"}}}),i,r;n.mount("#card-element");n.addEventListener("change",{error:n}=>{var t=document.getElementById("card-errors");t.textContent=n?n.message:""});i=n=>{var i=document.getElementById("payment-form"),t=document.createElement("input");t.setAttribute("type","hidden");t.setAttribute("name","stripeToken");t.setAttribute("value",n.id);i.appendChild(t);i.submit()};r=document.getElementById("payment-form");r.addEventListener("submit",r=>{r.preventDefault(),t.createToken(n).then(n=>{if(n.error){var t=document.getElementById("card-errors");t.textContent=n.error.message}else i(n.token)})})},n.address={},n.saveAddress=n=>{var r={FullName:n.FirstName+" "+n.LastName,Address1:n.Address1,City:n.City,State:n.State,ZipCode:n.ZipCode,Email:n.Email,Phone:n.Phone};console.log(r);i.post("/api/Checkout/SaveAddress",r).then(()=>{console.log("Address saved")});i.post("/api/Checkout/ConfirmationEmail",r).then(()=>{t.location.href="/Customer/Confirmation"})}}]);app.controller("PhotoCtrl",["$scope","$window","$location","$http","$mdDialog","$timeout","$q","Socialshare",(n,t,i,r,u,f,e,o)=>{n.viewPhoto=n=>{t.location.href="/Photographer/Photo/"+n},n.checkFilter=t=>t=t+"",t.indexOf(n.searchCode)>=0?!0:!1,n.goToCode=n=>{console.log("the code is "+n),t.location.href="/Photographer/PhotoCode?code="+n},n.goToPurchase=n=>{t.location.href="/Photo/Purchase/"+n},n.goToProfile=n=>{t.location.href="/Photographer/Profile/"+n},n.goToGallery=n=>{t.location.href="/Photographer/Photos/"+n},n.signInCustomer=n=>{r.get("/Session/SignIn/").then(t.location.href="/Photo/Purchase/"+n)},n.openUpload=n=>{u.show({templateUrl:"/Photographer/Upload",controller:"UploadController",locals:{folder:n},clickOutsideToClose:!0})},n.openBulkEdit=t=>{n.getPhotosByCode(t),n.selectedPhotos=[],angular.forEach(n.codePhotos,function(t){n.selectedPhotos.push(t.Id)}),u.show({locals:{selectedPhotos:n.selectedPhotos},templateUrl:"/Photographer/BulkEditModal",controller:"BulkEditModalCtrl",clickOutsideToClose:!0})},n.getPhotoCode=()=>{n.code=i.absUrl().split("=")[1],n.getPhotosByCode(n.code)},n.currentPage=1,n.photosPerPage=8,n.getPhotosByCode=t=>{r.get("/api/Photo/GetCodePhotos/"+t).then(t=>{n.codePhotos=t.data,console.log(n.codePhotos)})},n.getPhotographer=t=>{r.get("/api/Photo/GetPhotographer/"+t).then(t=>{n.photographer=t.data})},n.getUser=()=>{userApi.getUser().then(t=>{n.user=t.data})},n.shareFacebook=function(){var n=i.absUrl().split("?")[0];console.log(n);o.share({provider:"facebook",attrs:{socialshareUrl:n,socialshareHashtags:"PoU, kuvio, PhotosOfUs"}})},n.shareTwitter=function(){var n=i.absUrl().split("?")[0];console.log(n);o.share({provider:"twitter",attrs:{socialshareUrl:n,socialshareText:"Look at this awesome photo at PoU",socialshareHashtags:"PoU, kuvio, PhotosOfUs"}})},n.shareGooglePlus=function(){var n=i.absUrl().split("?")[0];console.log(n);o.share({provider:"google",attrs:{socialshareUrl:n}})},n.sharePinterest=function(n,t){var r=i.absUrl().split("?")[0];console.log(r);o.share({provider:"pinterest",attrs:{socialshareUrl:r,socialshareText:"Look at this awesome photo at PoU",socialshareMedia:t}})},n.shareTumblr=function(n,t){var r=i.absUrl().split("?")[0];console.log(r);o.share({provider:"tumblr",attrs:{socialshareUrl:r,socialshareText:"Look at this awesome photo at PoU",socialshareMedia:t}})},n.pricingOption="option2"}]);angular.module("app").controller("UploadController",function(n,t,i,r,u,f,e){n.folderId=e;n.close=()=>u.hide();var o=n.uploader=new i({url:"/Photographer/UploadPhotoAsync"});n.$watch(function(){return o.queue.length},function(t,i){t<i&&o.queue.length===0&&(n.dropZone={Height:300})});o.codeGenerator=function(n){n.upload()};n.photoNameValidation=function(n){for(var i=["drop table","alter table","create database","create table","create view","delete from","drop database","drop index","insert into","truncate table","script>"],t=0;t<i.length;t++)(n.target.value.indexOf(i[t])>-1||n.target.value.indexOf("select")>-1&&n.target.value.indexOf("from")>-1||n.target.value.indexOf("update")>-1&&n.target.value.indexOf("set")>-1)&&(n.target.value="Code detected",document.getElementById("photo-preview-name").focus(),document.getElementById("photo-preview-name").blur())};n.photoCodeValidation=function(n){var i=new RegExp("^[A-Za-z0-9_-]+$");i.test(n.key)?t.get("VerifyIfCodeAlreadyUsed").then(function(t){t.data.photoExisting===!0?(angular.element(n.target).addClass("error"),angular.element(n.target).prop("title","Photo code already used, choose another")):(angular.element(n.target).removeClass("error"),angular.element(n.target).prop("title",""))}):n.preventDefault()};o.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|tif".indexOf(t)!==-1}});n.upload=function(t){var i=n.VerifyErrorsInPhotoCode();i===!1?t.upload():alert("Fix the photos with exclamation first before uploading")};n.uploadAll=function(t){console.log("upload all clicked");var i=n.VerifyErrorsInPhotoCode();i===!1?(angular.forEach(t,function(n){n.formData[0].photoName=n.file.name;angular.forEach(n.tags,function(t){n.formData[0].tags+=" "+t.text});n.upload()}),n.saveAllUpload=!0):alert("Fix the photos with exclamation first before uploading")};n.VerifyErrorsInPhotoCode=function(){var n=!1,t=angular.element(document.querySelector(".code"));return angular.forEach(t,function(t){t.classList.contains("error")&&(n=!0)}),n};n.selectItem=function(t,i){n.selectedItem=i;console.log(o.queue)};n.removeItem=function(t){this.uploader.removeFromQueue(t);this.uploader.queue.length>0&&(n.selectedItem=this.uploader.queue[0])};o.onWhenAddingFileFailed=function(){};o.onAfterAddingFile=function(t){var r,i;console.log("on after adding file");n.dropZone={Height:100};r=t.file.name;t.file.fileExtension=r.split(".").pop();o.codeGenerator(t);i=new Image;i.src=window.URL.createObjectURL(t._file);i.onload=function(){t.file.dimensions=i.naturalWidth+"x"+i.naturalHeight;t.file.src=i.src;n.$apply()};n.selectedItem=t};o.onAfterAddingAll=function(){};o.onBeforeUploadItem=function(t){var i="";console.log(t.code);t.code&&(i=t.code);t.formData.length>0?t.formData[0].photoCode=i:t.formData.push({photoName:t.file.name,photoCode:i,extension:"."+t.file.fileExtension,folderId:n.folderId,tags:""})};o.onProgressItem=function(){};o.onProgressAll=function(){};o.onSuccessItem=function(n,t){if(console.log("uploader.onSuccessItem "+t),t.Code!=="")n.formData[0].photoCode=t.Code,n.code=t.Code,n.isCode=!0,n.suggestedTags=t.SuggestedTags;else{var i=o.queue.indexOf(n);n.formData[0].photoCode=o.queue[i-1].code;n.code=o.queue[i-1].code;n.suggestedTags=t.SuggestedTags}};o.onErrorItem=function(){};o.onCancelItem=function(){};o.onCompleteItem=function(){};o.onCompleteAll=()=>{n.saveAllUpload&&r.location.reload()}});app.controller("CardCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","cardApi","$timeout",(n,t,i,r,u,f,e)=>{n.close=()=>r.hide(),n.cards=[],n.cardsToExport=[],n.pageSize=5,n.currentPage=1,n.initCardCtrl=function(){n.cards=[];f.getAll().then(function(t){n.cards=t.data})},n.exportMultipleCardsModal=function(){r.show({templateUrl:"/Photographer/MultipleCardsModal",scope:n,clickOutsideToClose:!0})},n.exportMultipleCards=function(t){f.create(t).then(function(t){console.log(t.data);console.log(n.cards);n.cards=t.data.concat(n.cards);console.log(n.cards);r.hide();n.downloadCards(t.data)})},n.exportMultipleCards=function(t){f.create(t).then(function(t){console.log(t.data);console.log(n.cards);n.cards=t.data.concat(n.cards);console.log(n.cards);r.hide();n.downloadCards(t.data)})},n.MooModal=()=>{r.show({templateUrl:"/Photographer/MooOrderModal",scope:n,clickOutsideToClose:!0})},n.downloadCards=function(t){n.cardsToExport=t;e(function(){$("#card-downloader").submit()})},n.addFolder=function(i){folderApi.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)})}]);app.controller("PhotographerCtrl",["$scope","$window","$location","$http","$mdDialog","$filter","$timeout","photographerApi","userApi",(n,t,i,r,u,f,e,o,s)=>{n.tags=[],n.allTags=[],n.isBulkEditEnabled=!1,n.selectedPhotos=[],n.profilePhotos=[],n.isNotHighlighted={border:"3px solid green"},n.isHighlighted={border:"3px solid blue"},n.viewPhoto=n=>{t.location.href="/Photographer/Photo/"+n},n.isPhotoSelected=function(t){var i=n.selectedPhotos.indexOf(t);return i>-1?!0:!1},n.openUpload=()=>{u.show({locals:{selectedPhotos:n.selectedPhotos},templateUrl:"/Photographer/UploadProfilePhoto",controller:"ModalController",clickOutsideToClose:!0})},n.openBulkEdit=()=>{u.show({locals:{selectedPhotos:n.selectedPhotos},templateUrl:"/Photographer/BulkEditModal",controller:"BulkEditModalCtrl",clickOutsideToClose:!0})},n.getProfile=function(){o.getAccountSettings().then(function(t){n.photographer=t.data})},n.toggleSelection=function(){n.isBulkEditEnabled=!n.isBulkEditEnabled},n.selectPhoto=function(t){var i=n.selectedPhotos.indexOf(t);i>-1?n.selectedPhotos.splice(i,1):n.selectedPhotos.push(t)},n.deletePhotos=function(n){r.post("/api/Photographer/deletePhotos/",n)},n.getAllTags=function(){r.get("/api/Photo/GetAllTags/").then(function(t){angular.forEach(t.data,function(t){n.allTags.push(t)});console.log(JSON.stringify(t.data))})},n.loadTags=function(t){return e(function(){return f("filter")(n.allTags,t)})},n.getSearchString=function(n){var t="";return n.forEach(function(n){t+="+"+n.text}),t},n.searchPhotos=i=>{t.location.href="/Photographer/Results?tagnames=Image"+n.getSearchString(i)},n.getProfilePhotos=function(){r.get("/api/Photographer/getProfilePhotos/").then(function(t){angular.forEach(t.data,function(t){n.profilePhotos.push(t)})})},n.arrangePhotos=function(){var n=document.querySelector(".grid"),t;imagesLoaded(n,function(){t=new Masonry(n,{itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0})})},n.getUser=()=>{s.getUser().then(function(t){n.user=t.data})}}]);app.controller("UploadPhotographerProfileCtrl",["$scope","$http","FileUploader","$window","$mdDialog",function(n,t,i,r){var u=n.uploader=new i({url:"/Photographer/UploadProfilePhotoAsync"});n.$watch(function(){return u.queue.length},function(t,i){t<i&&u.queue.length===0&&(n.dropZone={Height:300})});n.photoNameValidation=function(n){for(var i=["drop table","alter table","create database","create table","create view","delete from","drop database","drop index","insert into","truncate table","script>"],t=0;t<i.length;t++)(n.target.value.indexOf(i[t])>-1||n.target.value.indexOf("select")>-1&&n.target.value.indexOf("from")>-1||n.target.value.indexOf("update")>-1&&n.target.value.indexOf("set")>-1)&&(n.target.value="Code detected",document.getElementById("photo-preview-name").focus(),document.getElementById("photo-preview-name").blur())};u.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|tif".indexOf(t)!==-1}});n.upload=function(n){n.upload()};n.uploadAll=function(t){console.log("clicked upload");angular.forEach(t,function(n){n.formData[0].photoName=n.file.name;angular.forEach(n.tags,function(t){n.formData[0].tags+=" "+t.text});n.upload()});n.saveAllUpload=!0};n.selectItem=function(t,i){n.selectedItem=i};n.removeItem=function(t){this.uploader.removeFromQueue(t);this.uploader.queue.length>0&&(n.selectedItem=this.uploader.queue[0])};u.onWhenAddingFileFailed=function(){};u.onAfterAddingFile=function(t){var r,i;console.log("on after adding file");n.dropZone={Height:100};r=t.file.name;t.file.fileExtension=r.split(".").pop();t.upload();i=new Image;i.src=window.URL.createObjectURL(t._file);i.onload=function(){t.file.dimensions=i.naturalWidth+"x"+i.naturalHeight;t.file.src=i.src;n.$apply()};n.selectedItem=t};u.onAfterAddingAll=function(){};u.onBeforeUploadItem=function(n){n.formData.push({photoName:n.file.name,price:n.file.price,extension:"."+n.file.fileExtension,tags:""})};u.onProgressItem=function(){};u.onProgressAll=function(){};u.onSuccessItem=function(n,t){n.suggestedTags=t.SuggestedTags};u.onErrorItem=function(){};u.onCancelItem=function(){};u.onCompleteItem=function(){};u.onCompleteAll=()=>{n.saveAllUpload&&r.location.reload()}}]);app.controller("PhotographerAccountCtrl",["$scope","$window","$location","$http","$mdDialog","photographerApi",(n,t,i,r,u,f)=>{n.originalSettings={},n.initAccountSettings=function(){f.getAccountSettings().then(function(t){console.log(t.data);n.accountSettings=t.data;n.accountSettings.Facebook==null&&(n.accountSettings.Facebook="https://www.facebook.com/");n.accountSettings.Twitter==null&&(n.accountSettings.Twitter="https://www.twitter.com/");n.accountSettings.Instagram==null&&(n.accountSettings.Instagram="https://www.instagram.com/");n.accountSettings.Dribbble==null&&(n.accountSettings.Dribbble="https://www.dribbble.com/");angular.copy(t.data,n.originalSettings)})},n.discardChanges=function(){console.log(JSON.stringify(n.originalSettings));n.accountSettings=angular.copy(n.originalSettings)},n.saveAccountSettings=function(t){console.log(JSON.stringify(t));n.showLoader=!0;f.saveAccountSettings(t).then(function(t){console.log(JSON.stringify(t));n.showLoader=!1;swal({position:"top-end",type:"success",title:"Your work has been saved",showConfirmButton:!1,timer:1500})},function(t){console.log(JSON.stringify(t));n.showLoader=!1;swal({position:"top-end",type:"error",title:"Oops... Something went wrong!",showConfirmButton:!1,timer:1500})})},n.uploadProfileImage=()=>{u.show({templateUrl:"/Photographer/UploadProfileImage",controller:"UploadProfileImageCtrl",clickOutsideToClose:!0})},n.close=()=>u.hide(),n.deactivateModal=(t,i)=>{t=="true"?u.show({templateUrl:"/Photographer/DeactivateModal",controller:"PhotographerAccountStatusCtrl",user:i,clickOutsideToClose:!0}):t=="false"&&n.reactivateAccount(i.Id)},n.reactivateAccount=n=>{r.post("/api/User/Reactivate/"+n).then(t.location.reload())},n.selected="details",n.setSelected=t=>{n.selected=t}}]).controller("PhotographerAccountStatusCtrl",["$scope","$window","$location","$http","$mdDialog","user",(n,t,i,r,u,f)=>{n.user=f,n.deactivateAccount=()=>{console.log(n.user.Id),r.post("/api/User/Deactivate/"+n.user.Id).then(t.location.reload())}}]);app.controller("CardCtrl",["$scope","$rootScope","$window","$mdDialog","photoApi","cardApi","$timeout",(n,t,i,r,u,f,e)=>{n.close=()=>r.hide(),n.cards=[],n.cardsToExport=[],n.pageSize=5,n.currentPage=1,n.initCardCtrl=function(){n.cards=[];f.getAll().then(function(t){n.cards=t.data})},n.exportMultipleCardsModal=function(){r.show({templateUrl:"/Photographer/MultipleCardsModal",scope:n,clickOutsideToClose:!0})},n.exportMultipleCards=function(t){f.create(t).then(function(t){console.log(t.data);console.log(n.cards);n.cards=t.data.concat(n.cards);console.log(n.cards);r.hide();n.downloadCards(t.data)})},n.exportMultipleCards=function(t){f.create(t).then(function(t){console.log(t.data);console.log(n.cards);n.cards=t.data.concat(n.cards);console.log(n.cards);r.hide();n.downloadCards(t.data)})},n.MooModal=()=>{r.show({templateUrl:"/Photographer/MooOrderModal",scope:n,clickOutsideToClose:!0})},n.downloadCards=function(t){n.cardsToExport=t;e(function(){$("#card-downloader").submit()})},n.addFolder=function(i){folderApi.add(i).then(function(i){n.close();t.$broadcast("FolderAdded",i.data)})},n.$on("FolderAdded",function(t,i){console.log("added folder - "+JSON.stringify(i));n.folders.push(i)})}]);app.controller("SalesHistoryCtrl",["$scope","$window","$location","$http",(n,t,i,r)=>{n.query="",n.querySalesHistory=n=>{$(".sales-container .overlay").addClass("loading"),r.get("/api/Photographer/SalesHistory?query="+n).then(n=>{n.status===200&&($(".sales-content").html(n.data),$(".sales-container .overlay").removeClass("loading"))})}}]);app.controller("PhotoTagCtrl",TagCtrl);app.controller("UploadProfileImageCtrl",["$scope","$http","FileUploader","$window","$mdDialog",function(n,t,i,r,u){n.close=()=>u.hide();var f=n.uploader=new i({url:"/Photographer/UploadProfileImageAsync"});n.$watch(function(){return f.queue.length},function(t,i){t<i&&f.queue.length===0&&(n.dropZone={Height:300})});n.photoNameValidation=function(n){for(var i=["drop table","alter table","create database","create table","create view","delete from","drop database","drop index","insert into","truncate table","script>"],t=0;t<i.length;t++)(n.target.value.indexOf(i[t])>-1||n.target.value.indexOf("select")>-1&&n.target.value.indexOf("from")>-1||n.target.value.indexOf("update")>-1&&n.target.value.indexOf("set")>-1)&&(n.target.value="Code detected",document.getElementById("photo-preview-name").focus(),document.getElementById("photo-preview-name").blur())};f.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|tif".indexOf(t)!==-1}});n.upload=function(n){n.upload()};n.uploadAll=function(n){console.log("clicked upload");angular.forEach(n,function(n){n.upload()})};n.selectItem=function(t,i){n.selectedItem=i};n.removeItem=function(t){this.uploader.removeFromQueue(t);this.uploader.queue.length>0&&(n.selectedItem=this.uploader.queue[0])};f.onWhenAddingFileFailed=function(){};f.onAfterAddingFile=function(t){var r,i;console.log("on after adding file");n.dropZone={Height:100};r=t.file.name;t.file.fileExtension=r.split(".").pop();i=new Image;i.src=window.URL.createObjectURL(t._file);i.onload=function(){t.file.dimensions=i.naturalWidth+"x"+i.naturalHeight;t.file.src=i.src;n.$apply()};n.selectedItem=t};f.onAfterAddingAll=function(){};f.onBeforeUploadItem=function(n){n.formData.push({photoName:n.file.name,extension:"."+n.file.fileExtension})};f.onProgressItem=function(){};f.onProgressAll=function(){};f.onErrorItem=function(){};f.onCancelItem=function(){};f.onCompleteItem=function(){};f.onCompleteAll=()=>{r.location.reload()}}]);app.controller("RandomPhotoCtrl",["$scope","$window","$location","$http",(n,t,i,r)=>{function u(n,t){return Math.floor(Math.random()*(t-n+1)+n)}n.getRandomPosition=n=>{var i=800-n.clientHeight,r=document.body.offsetWidth-n.clientWidth;let t=[u(0,i),u(650,900)];return console.log(t),t};n.photoList=[];n.getRandomPhoto=()=>{r.get("/api/Photo/GetPublicIds").then(t=>{n.randomize(t.data)})};n.randomize=t=>{let i=0,f=setInterval(function(){i+=1;i===15&&clearInterval(f);let o=t;var e=o[u(0,t.length-1)];r.get("/api/Photo/"+e).then(t=>{n.photoList.Id!=e&&n.photoList.push(t.data)})},0)}}]);